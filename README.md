# xfs_extentunpacker

XFSのエクステントデータをアンパックするプログラム

## 概要

XFSのデータアロケーションに用いられるエクステントの実体は128bitの次のようにパックされたデータです。

-	127 (1bit): flag\
	エクステントが示すデータブロックへの書き込みが行われていないことを示すフラグ。

-	126-72 (54bits): logical file block offset\
	ファイル内の論理的な開始位置。

-	72-21 (52bits): absolute block number\
	確保しているブロックの位置。

-	20-0 (21bits): # blocks\
	連続して確保しているブロックの数。

これらのエクステントはそのファイルが削除されたとしてもinode上には残っています。
しかし、削除されたファイルにおいて関連付けられたエクステントの数を示すdi_nextentsは0になるため、xfs_dbではそれらのエクステントの情報を表示してくれません。

xfs_db内のプロンプト上で

```
xfs_db> inode <inode番号>
xfs_db> type text
xfs_db> p
```

と入力することでinodeのバイナリデータが得られます。
(100バイト目以降が実際にエクステント等が格納される場所になります)

xfs_extentunpackerを実行し、16進数表記のバイナリを標準入力に与えることで、エクステントを示すバイナリから上記のデータを取り出すことができます。

## 使用方法

何も引数をつけずに実行し、標準入力に16進数表記で16バイトのバイナリを入力します。\
空白は無視されますが、改行はデータ終端とみなされます。

```
$ xfs_extentunpacker
00 00 00 00 00 00 00 00 00 05 06 65 48 40 10 00
```

上記の入力の場合、出力は以下のようになります。

```
flag: normal
fileoffset: 0
fsbindex: 674441794
block #: 4096
```

16進数表記で解析できない文字が出現した場合、解析した結果データサイズが16バイトではなかった場合、例外をスローして終了します。

## 参考資料

-	XFSファイルシステム構造[(https://sites.google.com/site/kandamotohiro/xfs)](https://sites.google.com/site/kandamotohiro/xfs)
